<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Wordlane Tech Admin Projects - Overview of all ongoing and completed projects.">
    <meta name="keywords" content="Admin Projects, HR, Tasks, Projects, Wordlane Tech">
    <meta name="author" content="Wordlane Tech">
    <title>WordLane Tech - Admin Projects</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #E2E7ED; }
        .header-gradient { background-image: linear-gradient(to top, #ffffff 0%, #e7e6e6ce 100%); }
        main { background: #E2E7ED; }
        .nav-link.active { color: #E2E7ED !important; background-color: #1F446A !important; box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.15); }
        .profile-container { position: relative; display: flex; align-items: center; gap: 0.75rem; padding: 0.45rem 0.75rem 0.45rem 0.375rem; background: #1F446A; border-radius: 50px; backdrop-filter: blur(10px); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.2), 0 0 0 1px rgba(255, 255, 255, 0.1); transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); overflow: hidden; }
        .profile-container::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent); transition: left 0.6s ease-in-out; }
        .profile-container:hover::before { left: 100%; }
        .profile-container:hover { transform: translateY(-2px) scale(1.02); box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.2), 0 0 20px rgba(14, 165, 233, 0.3); border-color: rgba(14, 165, 233, 0.5); }
        .profile-picture { position: relative; width: 36px; height: 36px; border-radius: 50%; overflow: hidden; border: 3px solid rgba(255, 255, 255, 0.3); box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.2); transition: all 0.3s ease; }
        .profile-picture::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: conic-gradient(from 0deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57, #ff9ff3, #54a0ff, #5f27cd, #ff6b6b); animation: rotate 3s linear infinite; z-index: -1; }
        .profile-picture::after { content: ''; position: absolute; inset: 3px; background: inherit; border-radius: 50%; z-index: 1; }
        .profile-picture img { position: relative; z-index: 2; width: 100%; height: 100%; object-fit: cover; border-radius: 50%; }
        .profile-container:hover .profile-picture { border-color: rgba(14, 165, 233, 0.8); box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.3), 0 0 15px rgba(14, 165, 233, 0.5); }
        .profile-info { display: flex; flex-direction: column; gap: 0.25rem; }
        .profile-name { font-weight: 600; font-size: 0.8rem; color: #ffffff; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3); margin: 0; }
        .profile-role { font-size: 0.65rem; color: rgba(255, 255, 255, 0.8); font-weight: 400; margin: 0; }
        .profile-status { position: absolute; top: -2px; right: -2px; width: 12px; height: 12px; background: linear-gradient(45deg, #10b981, #34d399); border: 2px solid #ffffff; border-radius: 50%; box-shadow: 0 2px 8px rgba(16, 185, 129, 0.4); animation: pulse 2s ease-in-out infinite; }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes pulse { 0%, 100% { transform: scale(1); box-shadow: 0 2px 8px rgba(16, 185, 129, 0.4); } 50% { transform: scale(1.2); box-shadow: 0 4px 16px rgba(16, 185, 129, 0.6); } }
        .profile-dropdown { position: absolute; top: calc(100% + 15px); right: -25px; background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.9) 100%); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 1rem; backdrop-filter: blur(15px); box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.3); z-index: 20; min-width: 180px; overflow: hidden; opacity: 0; visibility: hidden; transform: translateY(-10px) scale(0.95); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .profile-dropdown.show { opacity: 1; visibility: visible; transform: translateY(0) scale(1); }
        .profile-dropdown a { display: flex; align-items: center; padding: 0.875rem 1.25rem; color: #374151; font-weight: 500; text-decoration: none; transition: all 0.2s ease; border-bottom: 1px solid rgba(0, 0, 0, 0.05); }
        .profile-dropdown a:last-child { border-bottom: none; }
        .profile-dropdown a:hover { background: linear-gradient(135deg, rgba(14, 165, 233, 0.1) 0%, rgba(14, 165, 233, 0.05) 100%); color: #0ea5e9; transform: translate(-5px); }
        .profile-dropdown a i { margin-right: 0.75rem; font-size: 1.125rem; width: 20px; text-align: center; }
        .project-card { background: #ffffff; border-radius: 1.25rem; border: 1.5px solid #e2e7ed; box-shadow: 0 2px 8px 0 rgba(31, 68, 106, 0.06); transition: all 0.3s ease; position: relative; }
        .project-card:hover { box-shadow: 0 8px 24px 0 rgba(31, 68, 106, 0.12); transform: translateY(-2px); border-color: #b6cbe1; }
        .status-badge { font-weight: 600; border-radius: 9999px; padding: 0.25rem 1rem; font-size: 0.85rem; display: inline-block; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); }
        .status-badge-progress { background-color: #BFDBFE; color: #1E40AF; }
        .status-badge-completed { background-color: #D1FAE5; color: #065F46; }
        .status-badge-pending { background-color: #FEE2E2; color: #991B1B; }
        .progress-bar-container { background-color: #E5E7EB; height: 0.75rem; border-radius: 9999px; overflow: hidden; position: relative; }
        .progress-bar { height: 100%; background: linear-gradient(90deg, #3B82F6, #60A5FA); transition: width 0.5s ease-in-out; position: relative; }
        .progress-bar-text { color: #ffffff; font-weight: 700; font-size: 0.75rem; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2); line-height: 1.5; position: absolute; right: 0.5rem; top: 50%; transform: translateY(-50%); }
        @media (max-width: 768px) { .header-gradient { flex-direction: column; padding: 1rem; } .nav-list { flex-direction: column; align-items: center; gap: 0.25rem; padding: 0.5rem 0; } .nav-item { width: 100%; } .nav-link { justify-content: center; padding: 0.75rem 1rem; border-radius: 0.375rem; } .page-title { font-size: 2.5rem; } .profile-dropdown { right: 1rem; min-width: unset; width: calc(100% - 2rem); } .profile-container { padding: 0.5rem 1rem; gap: 0.75rem; } .profile-picture { width: 40px; height: 40px; } .profile-name { font-size: 0.85rem; } .profile-role { font-size: 0.7rem; } }
    </style>
</head>
<body class="bg-gray-50 font-sans antialiased min-h-screen flex flex-col">
    <header class="header-gradient p-3 shadow-lg flex flex-col sm:flex-row items-center justify-between sticky top-0 z-10 mt-3 mr-5 ml-5 mb-3" style="border-radius: 25px;">
        <!-- Left side: Logo and Company Name -->
        <a href="admin_dashboard.html" class="flex items-center mb-2 sm:mb-0 text-gray-800 no-underline hover:opacity-80 transition duration-200">
            <img src="../images/WLT_LOGO2.jpg" alt="Wordlane Tech Logo" class="mr-2 w-8 h-8" style="object-fit: cover; border-radius: 50px; border: 2px solid #1F446A;">
            <h1 class="text-lg font-bold tracking-wide" style="color: #1F446A;">WordLane Tech</h1>
        </a>
        <!-- Center: Navigation Links -->
        <nav class="bg-gray-100/50 p-1.5 rounded-full shadow-inner mb-2 md:mb-0" style="box-shadow:inset 1px 1px 6px 1px #57525224; padding: 8px 16px">
            <ul class="flex flex-wrap justify-center md:flex-nowrap list-none p-0 m-0 text-xs" style="gap: 4px;">
                <li><a href="admin_dashboard.html" class="nav-link flex items-center px-2 py-1 rounded-full text-gray-700 hover:bg-gray-200 transition-colors"><i class="fas fa-home mr-1.5" style="font-size: 0.95em;"></i> Dashboard</a></li>
                <li><a href="admin_employees.html" class="nav-link flex items-center px-2 py-1 rounded-full text-gray-700 hover:bg-gray-200 transition-colors"><i class="fas fa-users mr-1.5" style="font-size: 0.95em;"></i> Employees</a></li>
                <li><a href="admin_projects.html" class="nav-link flex items-center px-2 py-1 rounded-full text-gray-700 hover:bg-gray-200 transition-colors active"><i class="fas fa-briefcase mr-1.5" style="font-size: 0.95em;"></i> Projects</a></li>
                <li><a href="admin_tasks.html" class="nav-link flex items-center px-2 py-1 rounded-full text-gray-700 hover:bg-gray-200 transition-colors"><i class="fas fa-tasks mr-1.5" style="font-size: 0.95em;"></i> Tasks</a></li>
                <li><a href="admin_departments.html" class="nav-link flex items-center px-2 py-1 rounded-full text-gray-700 hover:bg-gray-200 transition-colors"><i class="fas fa-building mr-1.5" style="font-size: 0.95em;"></i> Departments</a></li>
                <li><a href="admin_teams.html" class="nav-link flex items-center px-2 py-1 rounded-full text-gray-700 hover:bg-gray-200 transition-colors"><i class="fas fa-user-friends mr-1.5" style="font-size: 0.95em;"></i> Teams</a></li>
                <li><a href="admin_attendance.html" class="nav-link flex items-center px-2 py-1 rounded-full text-gray-700 hover:bg-gray-200 transition-colors"><i class="fas fa-clipboard-check mr-1.5" style="font-size: 0.95em;"></i> Attendance</a></li>
                <li><a href="admin_leaves.html" class="nav-link flex items-center px-2 py-1 rounded-full text-gray-700 hover:bg-gray-200 transition-colors"><i class="fas fa-calendar-alt mr-1.5" style="font-size: 0.95em;"></i> Leaves</a></li>
                <li><a href="admin_documents.html" class="nav-link flex items-center px-2 py-1 rounded-full text-gray-700 hover:bg-gray-200 transition-colors"><i class="fas fa-file-alt mr-1.5" style="font-size: 0.95em;"></i> Documents</a></li>
                <li><a href="admin_reports.html" class="nav-link flex items-center px-2 py-1 rounded-full text-gray-700 hover:bg-gray-200 transition-colors"><i class="fas fa-chart-bar mr-1.5" style="font-size: 0.95em;"></i> Reports</a></li>
            </ul>
        </nav>
        <div class="relative">
            <button id="profileButton" class="profile-container focus:outline-none" aria-label="User Profile Menu">
                <div class="profile-picture">
                    <img src="https://placehold.co/48x48/CCCCCC/FFFFFF?text=AD" alt="Admin Profile">
                </div>
                <div class="profile-info">
                    <p class="profile-name" id="profileName"></p>
                    <p class="profile-role">Administrator</p>
                </div>
                <div class="profile-status"></div>
            </button>
            <div id="profileDropdown" class="profile-dropdown">
                <a href="#" class="flex items-center">
                    <i class="fas fa-user" aria-hidden="true"></i>
                    My Profile
                </a>
                <a href="../login.html" id="logoutButton" class="flex items-center">
                    <i class="fas fa-sign-out-alt" aria-hidden="true"></i>
                    Log Out
                </a>
            </div>
        </div>
    </header>
    <main class="flex-grow p-8 bg-gray-50">
        
        <div class="max-w-7xl mx-auto">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8">
                <h2 class="text-3xl font-extrabold text-gray-900 page-title mb-4 sm:mb-0">All Projects</h2>
                <button id="addDepartmentBtn" style="background: linear-gradient(0ea5e9, );" class="bg-gradient-to-r from-[#1F446A] to-[#0ea5e9] text-white font-bold py-2 px-4 rounded-lg shadow-md transition-all duration-500 ease-in-out flex items-center hover:shadow-lg hover:scale-105">
                    <i class="fas fa-plus mr-2"></i> Add New Project
                </button>
            </div>
            
            <div id="projectsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Project cards will be dynamically inserted here -->
            </div>
        </div>
    </main>
    <footer class="bg-gray-800 text-white p-4 text-center mt-auto rounded-t-lg">
        <p class="text-sm">&copy; 2025 Wordlane Tech. All rights reserved.</p>
    </footer>

    <!-- Add Department Modal -->
    <div id="addDepartmentModal" class="modal-overlay">
        <div class="modal-content max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-3">
                <h3 class="text-xl font-bold text-gray-900">Add New Department</h3>
                <button id="closeAddDepartmentModal" class="text-gray-400 hover:text-gray-600 transition-colors">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="addDepartmentForm" class="space-y-3">
                <div>
                    <label for="departmentName" class="block text-sm font-medium text-gray-700 mb-1">Department Name</label>
                    <input type="text" id="departmentName" name="department_name" required 
                           class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                </div>
                
                <div>
                    <label for="departmentId" class="block text-sm font-medium text-gray-700 mb-1">Department ID</label>
                    <input type="text" id="departmentId" name="department_id" required 
                           class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                </div>
                
                <div>
                    <label for="departmentDescription" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                    <textarea id="departmentDescription" name="department_description" rows="2" required 
                              class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"></textarea>
                </div>
                
                <div>
                    <label for="departmentHead" class="block text-sm font-medium text-gray-700 mb-1">Department Head (Employee ID)</label>
                    <input type="text" id="departmentHead" name="department_head" required 
                           class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                </div>
                
                <div class="flex justify-end space-x-3 pt-3">
                    <button type="button" id="cancelAddDepartment" 
                            class="px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-300">
                        Cancel
                    </button>
                    <button type="submit" 
                            class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-gradient-to-r from-[#1F446A] to-[#0ea5e9] hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-300">
                        Add Department
                    </button>
                </div>
            </form>
        </div>
    </div>
<script>
document.addEventListener('DOMContentLoaded', async () => {
    const profileButton = document.getElementById('profileButton');
    const profileDropdown = document.getElementById('profileDropdown');
    const projectsContainer = document.getElementById('projectsContainer');
    const logoutButton = document.getElementById('logoutButton');
    const profileName = document.getElementById('profileName');

    const token = localStorage.getItem("token");

    // -----------------------
    // Fetch & Set Profile Name
    // -----------------------
    let storedName = localStorage.getItem("user_name");

    if (!storedName && token) {
        try {
            const res = await fetch("http://localhost:3001/api/profile", {
                headers: { "Authorization": `Bearer ${token}` }
            });
            if (res.ok) {
                const user = await res.json();
                storedName = user.displayName || `${user.first_name || ''} ${user.last_name || ''}`.trim();
                localStorage.setItem("user_name", storedName);
            }
        } catch (err) {
            console.error("Failed to fetch user profile:", err);
        }
    }

    profileName.textContent = storedName || "Admin";

    // -----------------------
    // Profile Dropdown Toggle
    // -----------------------
    profileButton.addEventListener('click', (e) => {
        e.stopPropagation();
        profileDropdown.classList.toggle('show');
    });

    document.addEventListener('click', () => {
        profileDropdown.classList.remove('show');
    });

    // -----------------------
    // Logout
    // -----------------------
    logoutButton.addEventListener('click', (e) => {
        e.preventDefault();
        localStorage.clear();
        window.location.href = '../login.html';
    });

    // -----------------------
    // Project Cards
    // -----------------------
    function createProjectCard(project) {
        let statusClass = '';
        switch (project.status) {
            case 'In Progress': statusClass = 'status-badge-progress'; break;
            case 'Completed': statusClass = 'status-badge-completed'; break;
            case 'Pending': statusClass = 'status-badge-pending'; break;
        }
        return `
            <div class="project-card p-6 flex flex-col gap-4 cursor-pointer" 
                 onclick="window.location.href = 'admin_tasks.html?projectId=${project.project_id}';">
                <div class="flex justify-between items-start">
                    <h3 class="text-xl font-bold text-gray-900">${project.name}</h3>
                    <span class="status-badge ${statusClass}">${project.status}</span>
                </div>
                <p class="text-gray-600 text-sm flex-grow">${project.description}</p>
                <div>
                    <div class="text-xs text-gray-500 font-medium mb-1">Team: ${project.team_assigned || 'N/A'}</div>
                    <div class="text-xs text-gray-500 font-medium mb-2">Start Date: ${project.start_date || 'N/A'}</div>
                    <div class="text-xs text-gray-500 font-medium mb-2">Deadline: ${project.end_date || 'N/A'}</div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" style="width: ${project.completion || 0}%;">
                            <span class="progress-bar-text">${project.completion || 0}%</span>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    // -----------------------
    // Load Projects
    // -----------------------
    async function populateProjects() {
        try {
            if (!token) {
                window.location.href = '../login.html';
                return;
            }

            const response = await fetch('/api/projects', {
                method: 'GET',
                headers: { 
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            });

            if (!response.ok) {
                throw new Error('Failed to fetch projects');
            }

            const projectsData = await response.json();
            projectsContainer.innerHTML = projectsData.length 
                ? projectsData.map(createProjectCard).join('') 
                : `<p class="text-gray-500">No projects available</p>`;

        } catch (err) {
            console.error('Error fetching projects:', err);
            projectsContainer.innerHTML = `<p class="text-red-500">Failed to load projects</p>`;
        }
    }

    populateProjects();
});
</script>
</body>
</html>
